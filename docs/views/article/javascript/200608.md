---
title: 柯里化函数入门使用
date: 2020-06-16
categories:
  - 前端
tags:
  - JavaScript
---

## 前言

前几天面试突然被问到什么是柯里化，应该在什么场景下应用。惭愧的是本人从来没有用过，看来我还是前端小菜鸡。但看了几篇文章后，发现它非常实用。

## 什么是柯里化

柯里化不止在 javascript 中有，它是一种理念。以下来自百度百科的解释

> 在计算机科学中，柯里化（Currying）是把接受多个参数的函数变换成接受一个单一参数(最初函数的第一个参数)的函数，并且返回接受余下的参数且返回结果的新函数的技术。

按自己的理解就是，将接受多个参数，分批传入。举个简单的例子：

一个接收 3 个参数的普通函数，在进行柯里化后，柯里化版本的函数接收一个参数并返回接收下一个参数的函数，该函数返回一个接收第三个参数的函数。只有在函数在接收第三个参数的时候，才将之前接收到的三个参数应用于原普通函数中，并返回最终结果。

```javascript
// 三数相加普通函数
function sum(a, b, c) {
  console.log(a + b + c);
}

function curry(fn) {
  //...如何实现下面再详细说明
}

let _sum = curry(sum);
// 这里则可以分次传入参数
let a = _sum(1);

let b = a(2);
//接收到最后一个参数，将之前所有的参数应用到原函数中，并运行
b(3); // 6
```

这里有个小点就是，官方解释是每次只能传一个参数，而在 JavaScript 中每次传一个或多个参数都可以

```javascript
// 以下方式都可以
sum(1)(2)(3);
sum(1, 2)(3);
sum(1)(2, 3);
```

通过例子我们知道了柯里化是什么，那么应该如何实现呢？

## 柯里化的实现

通过柯里化的定义，我们知道主要是要知道柯里化函数是不是接受到足够参数去执行原函数。

获取参数长度有两种方法：

1. 创建柯里化函数时传入一个len参数定义长度
2. 获取原函数形参个数

```javascript
/**
 * 将函数柯里化
 * @param fn    待柯里化的原函数
 * @param len   所需的参数个数，默认为原函数的形参个数
 */
function curry(fn,len = fn.length) {
    return _curry.call(this,fn,len)
}

/**
 * 中转函数
 * @param fn    待柯里化的原函数
 * @param len   所需的参数个数
 * @param args  已接收的参数列表
 */
function _curry(fn,len,...args) {
    return function (...params) {
        let _args = [...args,...params];
        if(_args.length >= len){
            return fn.apply(this,_args);
        }else{
            return _curry.call(this,fn,len,..._args)
        }
    }
}
```

这样我们的柯里化函数就实现了，各位可以用上面的例子尝试一下

## 柯里化的应用场景

通过柯里化的实现我们知道，它最大的作用就是对之前传入的参数进行复用。将之后的每一步都拆开，让函数更有灵活性。

例如我们常常都要写一些正则表达式校验

```javascript
function checkByRegExp(regExp,string) {
    return regExp.test(string);  
}
```

如果我们分别要校验手机号和电子邮箱

```javascript
checkByRegExp(/^1\d{10}$/, '18642838455'); // 校验电话号码
checkByRegExp(/^1\d{10}$/, '13109840560'); // 校验电话号码
checkByRegExp(/^1\d{10}$/, '13204061212'); // 校验电话号码

checkByRegExp(/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/, 'test@163.com'); // 校验邮箱
checkByRegExp(/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/, 'test@qq.com'); // 校验邮箱
checkByRegExp(/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/, 'test@gmail.com'); // 校验邮箱
```

这样代码量就很多，而且相同正则会写多次。懒是程序员创造的动力Orz

```javascript
//进行柯里化
let _check = curry(checkByRegExp);
//生成工具函数，验证电话号码
let checkCellPhone = _check(/^1\d{10}$/);
//生成工具函数，验证邮箱
let checkEmail = _check(/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/);

checkCellPhone('18642838455'); // 校验电话号码
checkCellPhone('13109840560'); // 校验电话号码
checkCellPhone('13204061212'); // 校验电话号码

checkEmail('test@163.com'); // 校验邮箱
checkEmail('test@qq.com'); // 校验邮箱
checkEmail('test@gmail.com'); // 校验邮箱
```

这样是不是方便了很多？

## 参考

- [*「前端进阶」彻底弄懂函数柯里化* --云中桥](https://juejin.im/post/5d2299faf265da1bb67a3b65)
