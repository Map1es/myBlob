---
title: 关于Package.json
date: 2019-12-13
categories:
  - 前端
tags:
  - JavaScript
---

## 一、前言

作为一个只会用框架写页面的前端，突然意识到自己并不知道经常用的yarn npm命令安装各种包文件，以及打包文件是如何运行的；安装后，框架是如何找到这个文件；后来看到篇文章，讲的是关于```package.json```中的配置(在下文参考文章里)，才大致了解当我们创建了一个```Node.js```项目（```cli```也是基于```node```开发的），意味着创建了一个模块，这个模块的描述文件，被称为```package.json```，我们依靠着这个描述文件来找到我们安装的各种包文件以及我们自己配置的一些命令。所以让我们来了解一下```package.json```各种配置项是用来做什么的。

## 二、bin

```bin```是一个命令名和本地文件的映射。在包安装的时候，将会使用符号链接把这些文件链接到```prefix/bin```，如果是本地安装，会链接到```./node_modules/.bin/```。

```javascript
"bin": {
    "gynpm": "./bin/index.js"
}
```

**要注意**：这个index.js文件的头部必须有这个```#!/usr/bin/env node```节点， 否则脚本将在没有节点可执行文件的情况下启动。

例子：
package.json

```javascript
{
    "name": "cc",
    "version": "1.0.0",
    "description": "",
    "main": "index.js",
    "bin": {
        "mason": "./index.js"
    },
    "scripts": {},
    "keywords": [],
    "author": "",
    "license": "ISC",
    "dependencies": {}
}
```

index.js

```javascript
#!/usr/bin/env node

console.log('cool')
```

我们常用的```vue-cli```， ```create-react-app```等都是通过```bin```属性将命令映射到了全局上。

## 三、main

main很重要，它是我们项目的主要入口

## 四、scripts

```npm```允许在```package.json```文件里面，使用```scripts```字段定义脚本命令。

优点：项目的相关脚本，可以集中在一个地方。

```npm``` 脚本的原理非常简单。每当执行```npm run```（```yarn```就直接执行```yarn```），就会自动新建一个```Shell```，在这个 ```Shell``` 里面执行指定的脚本命令。因此，只要是 ```Shell```（一般是 ```Bash```）可以运行的命令，就可以写在 ```npm``` 脚本里面。

比较特别的是，```npm run```新建的这个 ```Shell```，会将当前目录的```node_modules/.bin```子目录加入PATH变量，执行结束后，再将PATH变量恢复原样。

这意味着，当前目录的```node_modules/.bin```子目录里面的所有脚本，都可以直接用脚本名调用，而不必加上路径。比如，当前项目的依赖里面有 ```Mocha```，只要直接写```mocha test```就可以了。

### 5.1 常用命令

脚本传参符号：--

```javascript
"server": "webpack-dev-server --mode=development --open --iframe=true "
```

脚本执行顺序

并行执行（即同时的平行执行），可以使用&符号

```javascript
# npm run script1.js & npm run script2.js
```

继发执行（即只有前一个任务成功，才执行下一个任务），可以使用&&符号

```javascript
# npm run script1.js && npm run script2.js
```

拿到package.json的变量

npm 脚本有一个非常强大的功能，就是可以使用 npm 的内部变量。
首先，通过npm_package_前缀，npm 脚本可以拿到```package.json```里面的字段。比如，下面是一个```package.json```。

```javascript
// package.json
{
  "name": "foo",
  "version": "1.2.5",
  "scripts": {
    "view": "node view.js"
  }
}
```

我们可以在自己的js中这样：

```javascript
console.log(process.env.npm_package_name); // foo
console.log(process.env.npm_package_version); // 1.2.5
```

## 六、dependencies和devDependencies

这两个主要就是存放我们项目依赖的库的地方了， ```devDependencies```主要是存放用于本地开发的， ```dependencies```会在我们开发的时候带到线上。
通过```npm i xxx -S```或```yarn xxx```会放在```dependencies```， ```npm i xxx -D```或```yarn xxx --dev```会放在```devDependencies```。所以我们在装包的时候一定要考虑这个包在线上是否用的到， 不要全都放到```dependencies```中，增加我们打包的体积和效率。

## 参考

- [*一文看清自己是不是真的掌握Package.json* --Vue中文社区](https://mp.weixin.qq.com/s/c2yV1fn89Sit2CaSwuPbYw)
